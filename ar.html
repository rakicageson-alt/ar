<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµ·ä¸Šç”ŸèŠ± AR</title>
    <!-- å¼•å…¥ A-Frame -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- å¼•å…¥ MindAR -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; }
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none;
            display: flex; flex-direction: column; justify-content: flex-end; align-items: center;
            padding-bottom: 50px;
        }
        .tip-box {
            background: rgba(0, 0, 0, 0.6); color: white; padding: 10px 20px;
            border-radius: 20px; font-size: 14px; margin-bottom: 10px;
            text-align: center; backdrop-filter: blur(4px);
        }
        .btn {
            background: #d4380d; /* æ¢ä¸ªæ›´è‰ºæœ¯çš„æ·±çº¢è‰² */
            color: white; border: none; padding: 12px 35px;
            border-radius: 50px; font-size: 18px; font-weight: bold;
            pointer-events: auto; 
            box-shadow: 0 4px 15px rgba(212, 56, 13, 0.4);
            display: none; transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <div id="overlay">
        <div class="tip-box" id="status-text">åˆå§‹åŒ–ç›¸æœºä¸­...</div>
        <button class="btn" id="action-btn" onclick="spawnWord()">ğŸŒ¸ ç‚¹å‡»ç”ŸèŠ±</button>
    </div>

    <!-- 
        é‡è¦ï¼šimageTargetSrc: './targets.mind' 
        è¿™é‡Œå‘Šè¯‰ç¨‹åºå»è¯»å–æ‚¨åˆšæ‰ç”Ÿæˆçš„è¯†åˆ«æ–‡ä»¶
    -->
    <a-scene mindar-image="imageTargetSrc: ./targets.mind; filterMinCF:0.0001; filterBeta: 0.001;" 
             color-space="sRGB" 
             renderer="colorManagement: true, physicallyCorrectLights" 
             vr-mode-ui="enabled: false" 
             device-orientation-permission-ui="enabled: false">

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- è¯†åˆ«åˆ°å›¾ç‰‡åï¼Œåœ¨è¿™ä¸ªå®¹å™¨é‡Œæ˜¾ç¤ºå†…å®¹ -->
        <a-entity id="target-anchor" mindar-image-target="targetIndex: 0">
            <!-- åŠ ä¸€ä¸ªåŠé€æ˜çš„å…‰æ™•æ•ˆæœç›–åœ¨å›¾ç‰‡ä¸Š -->
            <a-plane color="#fff" opacity="0.1" height="1" width="1.5"></a-plane>
            <a-entity id="word-group"></a-entity>
        </a-entity>
    </a-scene>

    <script>
        const statusText = document.getElementById('status-text');
        const actionBtn = document.getElementById('action-btn');
        const wordGroup = document.getElementById('word-group');
        const anchor = document.getElementById('target-anchor');

        // è¿™é‡Œå®šä¹‰ç‚¹å‡»åå‡ºç°çš„å­—
        const words = ["æµ·", "ä¸Š", "ç”Ÿ", "èŠ±"];
        // å®šä¹‰å­—çš„é¢œè‰²ï¼ˆæ°´å¢¨é£ï¼šé»‘ã€æ·±ç°ã€çº¢ï¼‰
        const colors = ["#000000", "#333333", "#d4380d", "#555555"];
        
        let count = 0;
        let isTargetFound = false;

        anchor.addEventListener("targetFound", event => {
            statusText.innerText = "å·²è¯†åˆ«ï¼è¯·ç‚¹å‡»æŒ‰é’®";
            actionBtn.style.display = "block";
            isTargetFound = true;
        });

        anchor.addEventListener("targetLost", event => {
            statusText.innerText = "è¯·å¯¹å‡†â€œæµ·ä¸Šç”ŸèŠ±â€å›¾ç‰‡";
            actionBtn.style.display = "none";
            isTargetFound = false;
        });

        function spawnWord() {
            if (!isTargetFound) return;

            const el = document.createElement('a-text');
            const word = words[count % words.length]; // è½®æµå–å­—
            const color = colors[count % colors.length];
            count++;

            // è®¾ç½®æ–‡å­—
            // æ³¨æ„ï¼šé»˜è®¤å­—ä½“å¯èƒ½ä¸æ”¯æŒå¤æ‚ä¸­æ–‡ï¼Œå¦‚æœæ˜¾ç¤ºä¹±ç ï¼Œéœ€è¦å¼•å…¥ä¸­æ–‡å­—ä½“åº“
            // ä¸ºç®€åŒ–æ¼”ç¤ºï¼Œè¿™é‡Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤æ¸²æŸ“ï¼Œå¦‚æœæ‰‹æœºä¸æ”¯æŒä¼šæ˜¾ç¤ºæ–¹æ¡†ã€‚
            // å®Œç¾æ–¹æ¡ˆéœ€è¦åŠ è½½ .fnt å­—ä½“æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨ a-image è´´å›¾ä»£æ›¿æ–‡å­—ã€‚
            el.setAttribute('value', word);
            el.setAttribute('color', color);
            el.setAttribute('align', 'center');
            
            // ä¸ºäº†è§£å†³ä¸­æ–‡å­—ä½“é—®é¢˜ï¼Œè¿™é‡Œä½¿ç”¨äº† MindAR é»˜è®¤å­—ä½“
            // å®é™…ä¸Šä¸ºäº†ç¾è§‚ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šåšæˆ 4 å¼ é€æ˜èƒŒæ™¯çš„ png å›¾ç‰‡æ¥ä»£æ›¿æ–‡å­—
            // è¿™é‡Œä¸ºäº†æ¼”ç¤ºä»£ç ç®€å•ï¼Œå…ˆç”¨ scale æ”¾å¤§æ–‡å­—
            el.setAttribute('scale', '3 3 3'); 

            // éšæœºä½ç½® (è®©å­—é£˜åœ¨å›¾ç‰‡ä¸Šæ–¹ä¸åŒä½ç½®)
            const randomX = (Math.random() - 0.5) * 1.2; 
            const randomY = (Math.random() - 0.5) * 0.8;
            const randomZ = Math.random() * 0.5 + 0.2; // æµ®èµ·çš„é«˜åº¦

            el.setAttribute('position', `${randomX} ${randomY} ${randomZ}`);

            // åŠ¨ç”»æ•ˆæœï¼šæ·¡å…¥ + ä¸Šæµ®
            el.setAttribute('animation__scale', {
                property: 'scale',
                from: '0 0 0',
                to: '3 3 3',
                dur: 800,
                easing: 'easeOutElastic'
            });

            wordGroup.appendChild(el);
        }
    </script>
</body>
</html>